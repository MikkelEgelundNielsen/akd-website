---
/**
 * NewsColumn Component
 * Column 1: "Nyt fra AKD"
 * Displays latest news with date bricks, categories and CTAs
 */

import DateBrick from './DateBrick.astro'
import type { DashboardNews, DashboardCategory } from '@/types/sanity'

interface Props {
  news: DashboardNews[]
  allNewsLink?: string
}

const { news, allNewsLink = '/andelshavere/nyheder' } = Astro.props

// Category label mapping
const categoryLabels: Record<DashboardCategory, string> = {
  'drift-kampagne': 'Drift & kampagne',
  'oekonomi': 'Økonomi',
  'generelt': 'Generelt',
}

// CTA text based on content type
const getCtaText = (contentType: 'article' | 'video') => {
  return contentType === 'video' ? 'Se video' : 'Læs hele nyheden her'
}

// Get link for news item
const getNewsLink = (item: DashboardNews) => {
  if (item.link) return item.link
  // Handle both string slug (from Sanity query) and object slug (from placeholder)
  const slugValue = typeof item.slug === 'string' ? item.slug : item.slug?.current
  return `/andelshavere/nyheder/${slugValue}`
}
---

<div class="news-column bg-light rounded-lg p-6">
  <h2 class="text-[29px] font-serif font-bold text-forest-green mb-6 uppercase tracking-wide">
    Nyt fra AKD
  </h2>
  
  {news && news.length > 0 ? (
    <ul class="space-y-5" role="list">
      {news.map((item) => (
        <li class="news-item flex gap-4">
          <DateBrick date={item.publishedAt} />
          <div class="flex-grow min-w-0">
            <h3 class="text-[22px] font-semibold text-charcoal leading-snug mb-1">
              {item.title}
            </h3>
            {item.excerpt && (
              <p class="text-sm text-charcoal/70 mb-2 line-clamp-2">
                {item.excerpt}
              </p>
            )}
            <a 
              href={getNewsLink(item)}
              class="inline-flex items-center gap-1 text-burnt-orange hover:text-amber transition-colors text-sm font-medium"
            >
              {getCtaText(item.contentType)}
              <span aria-hidden="true">→</span>
            </a>
          </div>
        </li>
      ))}
    </ul>
  ) : (
    <p class="text-charcoal/60 italic">Ingen nyheder at vise</p>
  )}
  
  <div class="mt-6 pt-4 border-t border-charcoal/10">
    <a 
      href={allNewsLink}
      class="inline-flex items-center gap-1 text-forest-green hover:text-burnt-orange transition-colors font-semibold"
    >
      Se alle nyheder
      <span aria-hidden="true">→</span>
    </a>
  </div>
</div>

<style>
  .news-item {
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(38, 37, 30, 0.08);
  }
  
  .news-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
