---
interface Props {
  quote: string
  name: string
  title: string
  location: string
  description: string
  imageUrl: string
  imageAlt: string
  backgroundColor: 'forest-green' | 'charcoal'
  imagePosition: 'left' | 'right'
  startDate?: string // ISO format: YYYY-MM-DD (CMS-ready)
}

const { 
  quote,
  name,
  title,
  location,
  description,
  imageUrl,
  imageAlt,
  backgroundColor,
  imagePosition,
  startDate
} = Astro.props

const bgColor = backgroundColor === 'forest-green' ? 'bg-forest-green' : 'bg-charcoal'
const textColor = 'text-white'
const accentColor = 'text-mint'

// Calculate Danish tenure text from ISO date string
function calculateTenure(dateStr: string): string {
  const [year, month] = dateStr.split('-').map(Number)
  const now = new Date()
  const totalMonths = (now.getFullYear() - year) * 12 + (now.getMonth() + 1 - month)

  if (totalMonths < 0) {
    return 'Starter snart.'
  } else if (totalMonths < 3) {
    return 'Ansat for f책 m책neder siden.'
  } else if (totalMonths < 12) {
    return `Ansat i ${totalMonths} m책neder.`
  } else {
    const years = Math.round(totalMonths / 12)
    return `Ansat i ${years} 책r.`
  }
}

// Format ISO date to Danish display format
function formatDanishDate(dateStr: string): string {
  const danishMonths = ['januar', 'februar', 'marts', 'april', 'maj', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'december']
  const [year, month, day] = dateStr.split('-').map(Number)
  return `${day}. ${danishMonths[month - 1]} ${year}`
}

const tenureText = startDate ? calculateTenure(startDate) : ''
const formattedDate = startDate ? formatDanishDate(startDate) : ''
---

<div class:list={[
  'relative rounded-lg shadow-2xl overflow-hidden',
  bgColor
]}>
  <div class:list={[
    'grid grid-cols-1 lg:grid-cols-2 lg:items-stretch',
    imagePosition === 'right' && 'lg:grid-flow-dense'
  ]}>
    <!-- Image -->
    <div class:list={[
      'relative h-64 md:h-96 lg:h-full overflow-hidden',
      imagePosition === 'right' && 'lg:col-start-2',
      imagePosition === 'left' && 'lg:rounded-l-lg',
      imagePosition === 'right' && 'lg:rounded-r-lg'
    ]}>
      <img 
        src={imageUrl}
        alt={imageAlt}
        class="w-full h-full object-cover"
      />
    </div>
    
    <!-- Content -->
    <div class:list={[
      'p-8 md:p-10 lg:p-12 flex flex-col justify-center',
      imagePosition === 'right' && 'lg:col-start-1'
    ]}>
      <!-- Quote -->
      <blockquote class:list={[
        'font-serif italic text-[29px] md:text-[40px] lg:text-[40px] leading-[3.2rem] mb-10 md:mb-12',
        textColor
      ]}>
        {quote}
      </blockquote>
      
      <!-- Name and Title -->
      <p class:list={[
        'font-sans font-semibold text-lg md:text-xl mb-3',
        accentColor
      ]}>
        {name}, {title}, {location}
      </p>
      
      <!-- Description + dynamic tenure -->
      <p class:list={[
        'text-lg md:text-xl leading-relaxed',
        textColor
      ]}>
        {description}<br/>{tenureText ? ` ${tenureText}` : ''}
      </p>

      
    </div>
  </div>
</div>

