---
import type { SubNavItem } from '@/lib/navigation'

interface Props {
  parentLabel: string
  items: SubNavItem[]
  currentPath: string
  theme?: 'light' | 'dark'
}

const { parentLabel, items, currentPath, theme = 'light' } = Astro.props

// Don't render if no items
if (!items || items.length === 0) return null

const textColor = theme === 'dark' ? 'text-white' : 'text-charcoal'
const bgColor = theme === 'dark' ? 'bg-forest-green' : 'bg-warm-light'
---

<div class={`sub-nav ${bgColor} border-t border-opacity-20 ${theme === 'dark' ? 'border-white' : 'border-gray-300'}`}>
  <div class="container-custom">
    <div class="flex items-center justify-between py-4 gap-4 md:gap-8">
      <!-- Parent label (left) -->
      <div class={`text-base md:text-lg font-light ${textColor} flex-shrink-0`}>
        {parentLabel}
      </div>
      
      <!-- Sub nav items (right, scrollable) -->
      <nav 
        class="flex-1 overflow-x-auto"
        aria-label="Undernavigation"
      >
        <ul class="flex items-center gap-4 md:gap-6 justify-end min-w-max" role="list">
          {items.map((item) => {
            // Skip items without href
            if (!item.href) return null
            
            // Check if this is an anchor link (starts with #)
            const isAnchor = item.href.startsWith('#')
            
            // For anchor links, keep as-is; for regular links, ensure href starts with /
            const href = isAnchor 
              ? item.href 
              : (item.href.startsWith('/') ? item.href : `/${item.href}`)
            
            // Check if current path matches exactly or is a sub-page (only for non-anchor links)
            const isActive = !isAnchor && (currentPath === href || (href !== '/' && currentPath.startsWith(href + '/')))
            
            return (
              <li>
                <a
                  href={href}
                  class={`sub-nav-link ${textColor} ${isActive ? 'active' : ''} ${isAnchor ? 'anchor-link' : ''}`}
                  aria-current={isActive ? 'page' : undefined}
                >
                  {item.label}
                </a>
              </li>
            )
          })}
        </ul>
      </nav>
    </div>
  </div>
</div>

<style>
  .sub-nav-link {
    @apply text-base md:text-lg font-normal pb-1 inline-block whitespace-nowrap
           border-b-4 border-transparent
           focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-burnt-orange
           relative;
  }
  
  /* Animated bottom stroke on hover */
  .sub-nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background-color: currentColor;
    transform: scaleX(0);
    transform-origin: center;
    transition: transform 0.3s ease;
  }
  
  .sub-nav-link:hover::after {
    transform: scaleX(1);
  }
  
  /* Active state overrides hover animation */
  .sub-nav-link.active {
    @apply font-bold border-burnt-orange;
  }
  
  .sub-nav-link.active::after {
    display: none;
  }
  
  /* Custom scrollbar for horizontal overflow */
  .overflow-x-auto {
    scrollbar-width: thin;
    scrollbar-color: rgba(231, 119, 34, 0.3) transparent;
  }
  
  .overflow-x-auto::-webkit-scrollbar {
    height: 4px;
  }
  
  .overflow-x-auto::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .overflow-x-auto::-webkit-scrollbar-thumb {
    @apply bg-burnt-orange/30 rounded-full;
  }
  
  .overflow-x-auto::-webkit-scrollbar-thumb:hover {
    @apply bg-burnt-orange/50;
  }
</style>

