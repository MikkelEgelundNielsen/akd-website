---
import BaseLayout from '@/layouts/BaseLayout.astro'
import { sanityClient } from '@/lib/sanity'
import { reportsPageQuery } from '@/lib/sanityQueries'
import { portableTextToHtml } from '@/lib/portableTextSerializer'
import type { ReportsPage } from '@/types/sanity'

export const prerender = true;

// Fetch page data from Sanity
let page: ReportsPage | null = null
try {
  page = await sanityClient.fetch<ReportsPage>(reportsPageQuery)
} catch (error) {
  console.error('Error fetching Reports page from Sanity:', error)
}

// Convert hero portable text to HTML
const headlineHtml = page?.hero?.headline
  ? portableTextToHtml(page.hero.headline, { addHeadingIds: false })
  : 'REGNSKABER & <span class="font-serif italic text-mint">vedtægter</span>'

const introHtml = page?.hero?.introText
  ? portableTextToHtml(page.hero.introText, { addHeadingIds: false })
  : '<p>Her finder du AKD\'s gældende vedtægter og årsrapporter.</p>'

// SEO
const metaTitle = page?.seo?.metaTitle || 'Regnskaber & vedtægter – AKD Danmark'
const metaDescription = page?.seo?.metaDescription || 'Download AKD\'s vedtægter og årsrapporter.'

// Fallbacks
const preHeadline = page?.hero?.preHeadline || 'Om AKD'

// Document groups (fallback data)
const documentGroups = page?.documentGroups || [
  {
    title: 'AKD\'s vedtægter',
    description: 'Her kan du gennemse og udskrive de gældende vedtægter for AKD.',
    documents: [
      { title: 'AKD\'s vedtægter' },
    ],
  },
  {
    title: 'AKD årsrapporter',
    description: 'Her kan du finde årsrapporter fra AKD:',
    documents: [
      { title: 'AKD\'s årsrapport 2024-25' },
      { title: 'AKD\'s årsrapport 2023-24' },
      { title: 'AKD\'s årsrapport 2022-23' },
    ],
  },
]
---

<BaseLayout 
  title={metaTitle}
  description={metaDescription}
  navTheme="light"
>
  <!-- Hero Section -->
  <section class="relative bg-warm-light pt-12 md:pt-16 lg:pt-20 pb-16 section-after-nav">
    <div class="container-custom">
      <p class="text-mint font-bold text-base mb-6 uppercase tracking-wide text-center">
        {preHeadline}
      </p>
      
      <h1 class="text-center mb-8 md:mb-12 max-w-4xl mx-auto">
        <span class="block font-sans font-extrabold text-[43px] md:text-[58px] lg:text-[62px] text-charcoal uppercase leading-tight [&_.font-serif]:lowercase [&_.font-serif]:font-medium" set:html={headlineHtml} />
      </h1>
      
      <div class="max-w-3xl mx-auto text-center [&_p]:text-charcoal [&_p]:text-lg [&_p]:md:text-xl [&_p]:leading-relaxed" set:html={introHtml} />
    </div>
  </section>

  <!-- Document Groups -->
  <section class="bg-warm-light pb-16 md:pb-24">
    <div class="container-custom">
      <div class="max-w-3xl mx-auto space-y-8">
        {documentGroups.map((group) => (
          <div class="bg-white rounded-2xl p-6 md:p-8 shadow-md">
            <h2 class="font-sans font-bold text-xl md:text-2xl text-charcoal mb-2">
              {group.title}
            </h2>
            {group.description && (
              <p class="text-charcoal/70 text-base mb-6">
                {group.description}
              </p>
            )}

            <div class="space-y-3">
              {group.documents.map((doc) => {
                const href = doc.fileUrl || doc.url || '#'
                const isExternal = !!doc.url && !doc.fileUrl
                return (
                  <a
                    href={href}
                    target={isExternal ? '_blank' : undefined}
                    rel={isExternal ? 'noopener noreferrer' : undefined}
                    download={doc.fileUrl ? '' : undefined}
                    class="flex items-center gap-3 text-charcoal hover:text-mint transition-colors group p-3 -mx-3 rounded-lg hover:bg-warm-light/50"
                  >
                    <svg class="w-5 h-5 text-mint flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="text-lg font-medium group-hover:underline">{doc.title}</span>
                    {isExternal && (
                      <svg class="w-4 h-4 text-charcoal/40 ml-auto flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                      </svg>
                    )}
                  </a>
                )
              })}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Bottom CTA Section -->
  <section class="bg-charcoal py-16 md:py-24">
    <div class="container-custom">
      <div class="flex flex-col sm:flex-row items-center justify-center gap-6">
        <a href="/om-akd/bestyrelse" class="btn-secondary">
          Bestyrelse
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
        
        <a href="/om-akd/ledelse" class="btn-primary">
          <span>Ledelse og administration</span>
          <span class="btn-icon-circle">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
