---
import BaseLayout from '@/layouts/BaseLayout.astro'
import { sanityClient } from '@/lib/sanity'
import { managementPageQuery } from '@/lib/sanityQueries'
import { portableTextToHtml } from '@/lib/portableTextSerializer'
import type { ManagementPage } from '@/types/sanity'

export const prerender = true;

// Fetch page data from Sanity
let page: ManagementPage | null = null
try {
  page = await sanityClient.fetch<ManagementPage>(managementPageQuery)
} catch (error) {
  console.error('Error fetching Management page from Sanity:', error)
}

// Convert hero portable text to HTML
const headlineHtml = page?.hero?.headline
  ? portableTextToHtml(page.hero.headline, { addHeadingIds: false })
  : 'LEDELSE OG <span class="font-serif italic text-mint">administration</span>'

const introHtml = page?.hero?.introText
  ? portableTextToHtml(page.hero.introText, { addHeadingIds: false })
  : '<p>Bag AKD\'s daglige drift står et engageret team af ledere og administrative medarbejdere, der arbejder for at sikre en effektiv og ansvarlig virksomhed.</p>'

// SEO
const metaTitle = page?.seo?.metaTitle || 'Ledelse og administration – AKD Danmark'
const metaDescription = page?.seo?.metaDescription || 'Mød AKD\'s ledelse og administrative team.'

// Fallbacks
const preHeadline = page?.hero?.preHeadline || 'Om AKD'

// Members (fallback data)
const members = page?.members || [
  { name: 'Jens Christian Jørgensen', role: 'Direktør', phone: '74 83 13 43', mobile: '81 80 12 25', email: 'jcj@akddanmark.dk' },
  { name: 'Henrik Andersen', role: 'Driftdirektør', mobile: '51 74 02 60', email: 'hna@akddanmark.dk' },
  { name: 'Bjarne Thisgaard', role: 'Agrochef', mobile: '40 27 96 95', email: 'bt@akddanmark.dk' },
  { name: 'Anne Grethe Jepsen', role: 'Souschef', phone: '74 83 13 43', mobile: '22 52 16 51', email: 'agj@akddanmark.dk' },
  { name: 'Michael Gejl', role: 'Regnskabschef', mobile: '29 65 32 49', email: 'mig@akddanmark.dk' },
  { name: 'Marianne Schmidt', role: 'Regnskabsansvarlig', phone: '74 83 13 43', email: 'ms@akddanmark.dk' },
  { name: 'Anja Ry Milton', role: 'Administration', phone: '61 13 91 31', email: 'ami@akddanmark.dk' },
  { name: 'Majbritt Friis Christiansen', role: 'Administrativ medarbejder', phone: '74 83 13 43', mobile: '25 63 10 15', email: 'mfc@akddanmark.dk' },
  { name: 'Lisbeth Sand', role: 'Administrativ medarbejder', email: 'lsa@akddanmark.dk' },
  { name: 'Frederik Gubi Elbæk Jensen', role: 'Agrorådgiver', mobile: '51 51 64 33', email: 'fje@akddanmark.dk' },
]
---

<BaseLayout 
  title={metaTitle}
  description={metaDescription}
  navTheme="light"
>
  <!-- Hero Section -->
  <section class="relative bg-warm-light pt-12 md:pt-16 lg:pt-20 pb-16 section-after-nav">
    <div class="container-custom">
      <p class="text-mint font-bold text-base mb-6 uppercase tracking-wide text-center">
        {preHeadline}
      </p>
      
      <h1 class="text-center mb-8 md:mb-12 max-w-4xl mx-auto">
        <span class="block font-sans font-extrabold text-[43px] md:text-[58px] lg:text-[62px] text-charcoal uppercase leading-tight [&_.font-serif]:lowercase [&_.font-serif]:font-medium" set:html={headlineHtml} />
      </h1>
      
      <div class="max-w-3xl mx-auto text-center [&_p]:text-charcoal [&_p]:text-lg [&_p]:md:text-xl [&_p]:leading-relaxed" set:html={introHtml} />
    </div>
  </section>

  <!-- Management Grid -->
  <section class="bg-warm-light pb-16 md:pb-24">
    <div class="container-custom">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
        {members.map((member) => (
          <div class="bg-white rounded-2xl p-6 shadow-md">
            {/* Role */}
            {member.role && (
              <p class="text-mint font-semibold text-sm uppercase tracking-wide mb-2">
                {member.role}
              </p>
            )}

            {/* Name */}
            <h2 class="font-sans font-bold text-lg text-charcoal mb-4">
              {member.name}
            </h2>

            {/* Contact details */}
            <div class="space-y-2 text-sm">
              {member.phone && (
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-charcoal/40 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                  </svg>
                  <span class="text-charcoal/50">Tlf:</span>
                  <a href={`tel:+45${member.phone.replace(/\s/g, '')}`} class="text-charcoal font-semibold hover:text-mint transition-colors">
                    {member.phone}
                  </a>
                </div>
              )}
              {member.mobile && (
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-charcoal/40 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                  </svg>
                  <span class="text-charcoal/50">Mobil:</span>
                  <a href={`tel:+45${member.mobile.replace(/\s/g, '')}`} class="text-charcoal font-semibold hover:text-mint transition-colors">
                    {member.mobile}
                  </a>
                </div>
              )}
              {member.email && (
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-charcoal/40 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                  </svg>
                  <a href={`mailto:${member.email}`} class="text-mint hover:underline font-medium truncate">
                    {member.email}
                  </a>
                </div>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Bottom CTA Section -->
  <section class="bg-charcoal py-16 md:py-24">
    <div class="container-custom">
      <div class="flex flex-col sm:flex-row items-center justify-center gap-6">
        <a href="/om-akd/bestyrelse" class="btn-secondary">
          Bestyrelse
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
        
        <a href="/om-akd/regnskaber-vedtaegter" class="btn-primary">
          <span>Regnskaber & vedtægter</span>
          <span class="btn-icon-circle">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
